{% extends 'base.html' %}

{% block title %}Adicionar Funcionário - LUMOB{% endblock %}

{% block messages %}{% endblock %} 

{% block content %}
<div class="container custom-form-container mt-4 mb-4 p-4">
    {# Título geral da página #}
    <div class="title-band mb-4">
        <h1 class="text-white text-center mb-0"><i class="fas fa-user-plus me-3"></i>Adicionar Novo Funcionário</h1>
    </div>

    {# Bloco para Flash Messages #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flash-messages">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div class="section-title custom-section-title">Importação em Massa</div>
    <div class="mb-4 p-3" style="background-color: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
        <p class="custom-form-label" style="font-size: 0.85rem; color: #dee2e6;">Para adicionar múltiplos funcionários de uma vez, baixe o nosso template, preencha os dados e envie o arquivo abaixo.</p>
        
        <a href="{{ url_for('pessoal_bp.download_funcionario_template') }}" class="btn btn-success mb-3">
            <i class="fas fa-file-excel me-2"></i>Baixar Template
        </a>

        <form action="{{ url_for('pessoal_bp.import_funcionarios') }}" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
                <label for="file" class="form-label custom-form-label">Selecione o arquivo (CSV ou Excel):</label>
                <input type="file" class="form-control custom-form-control" name="file" id="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" required>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-primary custom-import-btn">
                    <i class="fas fa-upload me-2"></i>Importar Arquivo
                </button>
                <a href="{{ url_for('pessoal_bp.funcionarios_module') }}" class="btn btn-secondary custom-cancel-btn">Cancelar</a>
            </div>
        </form>
    </div>
    <div class="section-title custom-section-title">Cadastro Individual</div>
    <form action="{{ url_for('pessoal_bp.add_funcionario') }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="mb-3">
            <label for="matricula" class="form-label custom-form-label">Matrícula:</label>
            <input type="text" id="matricula" name="matricula" class="form-control custom-form-control" value="{{ form_data['matricula']|default(next_matricula) }}" required>
        </div>
        <div class="mb-3">
            <label for="nome_completo" class="form-label custom-form-label">Nome Completo:</label>
            <input type="text" id="nome_completo" name="nome_completo" class="form-control custom-form-control" value="{{ form_data['nome_completo']|default('') }}" required>
        </div>
        <div class="mb-3">
            <label for="data_admissao" class="form-label custom-form-label">Data de Admissão:</label>
            <input type="date" id="data_admissao" name="data_admissao" class="form-control custom-form-control" value="{{ form_data['data_admissao']|default('') }}" required>
        </div>
        <div class="mb-3">
            <label for="id_cargos" class="form-label custom-form-label">Cargo:</label>
            <select id="id_cargos" name="id_cargos" class="form-select custom-form-control" required>
                <option value="">Selecione um Cargo</option>
                {% for cargo in all_cargos %}
                    <option value="{{ cargo.ID_Cargos }}" {% if form_data['id_cargos']|default('')|int == cargo.ID_Cargos %}selected{% endif %}>
                        {{ cargo.Nome_Cargo }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="id_niveis" class="form-label custom-form-label">Nível:</label>
            <select id="id_niveis" name="id_niveis" class="form-select custom-form-control" required>
                <option value="">Selecione um Nível</option>
                {% for nivel in all_niveis %}
                        <option value="{{ nivel.ID_Niveis }}" {% if form_data['id_niveis']|default('')|int == nivel.ID_Niveis %}selected{% endif %}>
                            {{ nivel.Nome_Nivel }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label custom-form-label">Status:</label>
                <select id="status" name="status" class="form-select custom-form-control" required>
                    <option value="">Selecione o Status</option>
                    {% for status_opt in status_options %}
                        <option value="{{ status_opt }}" {% if form_data['status']|default('') == status_opt %}selected{% endif %}>{{ status_opt }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="tipo_contratacao" class="form-label custom-form-label">Tipo de Contratação:</label>
                <select id="tipo_contratacao" name="tipo_contratacao" class="form-select custom-form-control" required>
                    <option value="CLT" {% if form_data.tipo_contratacao == 'CLT' %}selected{% endif %}>CLT</option>
                    <option value="PJ" {% if form_data.tipo_contratacao == 'PJ' %}selected{% endif %}>PJ</option>
                    <option value="Temporario" {% if form_data.tipo_contratacao == 'Temporario' %}selected{% endif %}>Temporário</option>
                </select>
            </div>
            <div class="section-title custom-section-title">Dados Pessoais e Documentos</div>
            <div class="mb-3">
                <label for="rg_numero" class="form-label custom-form-label">RG Número:</label>
                <input type="text" id="rg_numero" name="rg_numero" class="form-control custom-form-control" value="{{ form_data['rg_numero']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="rg_orgao_emissor" class="form-label custom-form-label">RG Órgão Emissor:</label>
                <input type="text" id="rg_orgao_emissor" name="rg_orgao_emissor" class="form-control custom-form-control" value="{{ form_data['rg_orgao_emissor']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="rg_uf_emissor" class="form-label custom-form-label">RG UF Emissor:</label>
                <input type="text" id="rg_uf_emissor" name="rg_uf_emissor" class="form-control custom-form-control" value="{{ form_data['rg_uf_emissor']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="rg_data_emissao" class="form-label custom-form-label">RG Data Emissão:</label>
                <input type="date" id="rg_data_emissao" name="rg_data_emissao" class="form-control custom-form-control" value="{{ form_data['rg_data_emissao']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="cpf_numero" class="form-label custom-form-label">CPF:</label>
                <input type="text" id="cpf_numero" name="cpf_numero" class="form-control custom-form-control" value="{{ form_data['cpf_numero']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="ctps_numero" class="form-label custom-form-label">CTPS Número:</label>
                <input type="text" id="ctps_numero" name="ctps_numero" class="form-control custom-form-control" value="{{ form_data['ctps_numero']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="ctps_serie" class="form-label custom-form-label">CTPS Série:</label>
                <input type="text" id="ctps_serie" name="ctps_serie" class="form-control custom-form-control" value="{{ form_data['ctps_serie']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="pispasep" class="form-label custom-form-label">PIS/PASEP:</label>
                <input type="text" id="pispasep" name="pispasep" class="form-control custom-form-control" value="{{ form_data['pispasep']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="cnh_numero" class="form-label custom-form-label">CNH Número:</label>
                <input type="text" id="cnh_numero" name="cnh_numero" class="form-control custom-form-control" value="{{ form_data['cnh_numero']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="cnh_categoria" class="form-label custom-form-label">CNH Categoria:</label>
                <input type="text" id="cnh_categoria" name="cnh_categoria" class="form-control custom-form-control" value="{{ form_data['cnh_categoria']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="cnh_data_validade" class="form-label custom-form-label">CNH Data Validade:</label>
                <input type="date" id="cnh_data_validade" name="cnh_data_validade" class="form-control custom-form-control" value="{{ form_data['cnh_data_validade']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="cnh_orgao_emissor" class="form-label custom-form-label">CNH Órgão Emissor:</label>
                <input type="text" id="cnh_orgao_emissor" name="cnh_orgao_emissor" class="form-control custom-form-control" value="{{ form_data['cnh_orgao_emissor']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="titeleitor_numero" class="form-label custom-form-label">Título Eleitor Número:</label>
                <input type="text" id="titeleitor_numero" name="titeleitor_numero" class="form-control custom-form-control" value="{{ form_data['titeleitor_numero']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="titeleitor_zona" class="form-label custom-form-label">Título Eleitor Zona:</label>
                <input type="text" id="titeleitor_zona" name="titeleitor_zona" class="form-control custom-form-control" value="{{ form_data['titeleitor_zona']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="titeleitor_secao" class="form-label custom-form-label">Título Eleitor Seção:</label>
                <input type="text" id="titeleitor_secao" name="titeleitor_secao" class="form-control custom-form-control" value="{{ form_data['titeleitor_secao']|default('') }}">
            </div>

            <div class="mb-3">
                <label for="data_nascimento" class="form-label custom-form-label">Data de Nascimento:</label>
                <input type="date" id="data_nascimento" name="data_nascimento" class="form-control custom-form-control" value="{{ form_data['data_nascimento']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="estado_civil" class="form-label custom-form-label">Estado Civil:</label>
                <select id="estado_civil" name="estado_civil" class="form-select custom-form-control">
                    <option value="">Selecione</option>
                    {% for ec in estado_civil_options %}
                        <option value="{{ ec }}" {% if form_data['estado_civil']|default('') == ec %}selected{% endif %}>{{ ec }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="nacionalidade" class="form-label custom-form-label">Nacionalidade:</label>
                <input type="text" id="nacionalidade" name="nacionalidade" class="form-control custom-form-control" value="{{ form_data['nacionalidade']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="naturalidade" class="form-label custom-form-label">Naturalidade:</label>
                <input type="text" id="naturalidade" name="naturalidade" class="form-control custom-form-control" value="{{ form_data['naturalidade']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="genero" class="form-label custom-form-label">Gênero:</label>
                <select id="genero" name="genero" class="form-select custom-form-control">
                    <option value="">Selecione</option>
                    {% for g in genero_options %}
                        <option value="{{ g }}" {% if form_data['genero']|default('') == g %}selected{% endif %}>{{ g }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="observacoes_doc" class="form-label custom-form-label">Observações Documentos:</label>
                <textarea id="observacoes_doc" name="observacoes_doc" class="form-control custom-form-control">{{ form_data['observacoes_doc']|default('') }}</textarea>
            </div>
            <div class="mb-3">
                <label for="link_foto" class="form-label custom-form-label">Link da Foto:</label>
                <input type="text" id="link_foto" name="link_foto" class="form-control custom-form-control" value="{{ form_data['link_foto']|default('') }}">
            </div>
            
            <div class="section-title custom-section-title">Endereço Residencial</div>
            <div class="mb-3">
                <label for="logradouro" class="form-label custom-form-label">Logradouro:</label>
                <input type="text" id="logradouro" name="logradouro" class="form-control custom-form-control" value="{{ form_data['logradouro']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="numero_end" class="form-label custom-form-label">Número:</label>
                <input type="text" id="numero_end" name="numero_end" class="form-control custom-form-control" value="{{ form_data['numero_end']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="complemento" class="form-label custom-form-label">Complemento:</label>
                <input type="text" id="complemento" name="complemento" class="form-control custom-form-control" value="{{ form_data['complemento']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="bairro" class="form-label custom-form-label">Bairro:</label>
                <input type="text" id="bairro" name="bairro" class="form-control custom-form-control" value="{{ form_data['bairro']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="cidade" class="form-label custom-form-label">Cidade:</label>
                <input type="text" id="cidade" name="cidade" class="form-control custom-form-control" value="{{ form_data['cidade']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="estado_end" class="form-label custom-form-label">Estado (UF):</label>
                <input type="text" id="estado_end" name="estado_end" class="form-control custom-form-control" value="{{ form_data['estado_end']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="cep" class="form-label custom-form-label">CEP:</label>
                <input type="text" id="cep" name="cep" class="form-control custom-form-control" value="{{ form_data['cep']|default('') }}">
            </div>

            <div class="section-title custom-section-title">Contatos</div>
            <div class="mb-3">
                <label for="tel_principal" class="form-label custom-form-label">Telefone Principal:</label>
                <input type="text" id="tel_principal" name="tel_principal" class="form-control custom-form-control" value="{{ form_data['tel_principal']|default('') }}">
            </div>
            <div class="mb-3">
                <label for="email_pessoal" class="form-label custom-form-label">E-mail Pessoal:</label>
                <input type="email" id="email_pessoal" name="email_pessoal" class="form-control custom-form-control" value="{{ form_data['email_pessoal']|default('') }}">
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-primary custom-submit-btn">Adicionar Funcionário</button>
                <a href="{{ url_for('pessoal_bp.funcionarios_module') }}" class="btn btn-secondary custom-cancel-btn">Cancelar</a>
            </div>
        </form>
</div>

<style>
    /* Estilos Customizados para o Título como Faixa */
    .title-band {
        background-color: #212529; /* Preto ou cinza escuro */
        padding: 0.75rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
    }
    .title-band h1 {
        color: white;
        margin-bottom: 0;
        font-size: 1.5rem; /* Título menor para design minimalista */
    }

    /* Estilos para o Container Principal do Formulário (Fumê, Estreito, 3D) */
    .custom-form-container {
        max-width: 600px;
        margin-left: auto;
        margin-right: auto; /* Centralizado */
        background-color: rgba(33, 37, 41, 0.85); /* Fundo preto com transparência (vidro fumê) */
        border: 1px solid #000000; /* Borda preta fina */
        border-radius: 0.75rem; /* Cantos arredondados */
        box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.3), 
                    0 0.25rem 0.5rem rgba(0, 0, 0, 0.2); /* Efeito 3D mais pronunciado */
        padding: 1.5rem;
        position: relative;
        transform: translateY(-3px);
    }

    /* Estilos para Labels e Inputs/Selects */
    .custom-form-label {
        color: #f8f9fa;
        font-size: 0.8rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    .custom-form-control {
        font-size: 0.85rem;
        background-color: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #212529;
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: all 0.2s ease-in-out;
    }
    .custom-form-control:focus {
        background-color: rgba(255, 255, 255, 1);
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        transform: translateY(-1px);
    }
    textarea.custom-form-control {
        resize: vertical;
        min-height: 80px;
    }

    /* Estilos para Títulos de Seção */
    .custom-section-title {
        background-color: rgba(255, 255, 255, 0.1);
        color: #f8f9fa;
        padding: 0.75rem 1rem;
        border-radius: 0.3rem;
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-size: 1rem;
        font-weight: 600;
        border-left: 4px solid #198754;
    }
    .custom-section-title:first-of-type {
        margin-top: 0;
    }

    /* Estilos para os Botões */
    .custom-submit-btn, .custom-cancel-btn, .custom-import-btn {
        padding: 0.6rem 1.2rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.3s ease-in-out;
        border: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .custom-submit-btn {
        background: linear-gradient(135deg, #198754, #157347);
        color: white;
        box-shadow: 0 0.25rem 0.5rem rgba(25, 135, 84, 0.3);
    }
    .custom-submit-btn:hover {
        background: linear-gradient(135deg, #157347, #146c43);
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 1rem rgba(25, 135, 84, 0.4);
    }
    /* Botão de Importar (AZUL) */
    .custom-import-btn {
        background: linear-gradient(135deg, #0d6efd, #0b5ed7);
        color: white;
        box-shadow: 0 0.25rem 0.5rem rgba(13, 110, 253, 0.3);
    }
    .custom-import-btn:hover {
        background: linear-gradient(135deg, #0b5ed7, #0a58ca);
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 1rem rgba(13, 110, 253, 0.4);
    }
    /* Botão Cancelar (VERMELHO) */
    .custom-cancel-btn {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
        box-shadow: 0 0.25rem 0.5rem rgba(220, 53, 69, 0.3);
    }
    .custom-cancel-btn:hover {
        background: linear-gradient(135deg, #c82333, #bd2130);
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 1rem rgba(220, 53, 69, 0.4);
    }
    .custom-submit-btn:active, .custom-cancel-btn:active, .custom-import-btn:active {
        transform: translateY(-1px);
    }
    .custom-submit-btn::before, .custom-cancel-btn::before, .custom-import-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s ease-in-out;
    }
    .custom-submit-btn:hover::before, .custom-cancel-btn:hover::before, .custom-import-btn:hover::before {
        left: 100%;
    }
    /* Estilos para flash messages */
    .flash-messages {
        list-style: none;
        padding: 0;
        margin-bottom: 1rem;
    }
    .flash-messages li {
        padding: 0.75rem 1.25rem;
        margin-bottom: 1rem;
        border: 1px solid transparent;
        border-radius: 0.25rem;
        font-weight: bold;
    }
    .flash-messages li.success {
        color: #155724;
        background-color: #d4edda;
        border-color: #c3e6cb;
    }
    .flash-messages li.danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6fb; 
    }
    .flash-messages li.info {
        color: #0c5460;
        background-color: #d1ecf1;
        border-color: #bee5eb;
    }
</style>
{% endblock %}